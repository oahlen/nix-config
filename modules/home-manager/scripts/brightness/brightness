#!/usr/bin/env bash

# Usage: ./brightness.sh up|down [amount]
# amount is percentage (default: 5%)

DIRECTION="$1"
AMOUNT="${2:-5}"

NOTIFY_ID_FILE="/tmp/brightness_notify_id"

if [[ "$DIRECTION" == "up" ]]; then
    brightnessctl set +"$AMOUNT"% 
elif [[ "$DIRECTION" == "down" ]]; then
    brightnessctl set "$AMOUNT"%- 
else
    echo "Usage: $0 up|down [amount]"
    exit 1
fi

CURRENT=$(brightnessctl get)
MAX=$(brightnessctl max)
PERCENT=$(( CURRENT * 100 / MAX ))

# Get previous notification ID if exists
if [[ -f "$NOTIFY_ID_FILE" ]]; then
    REPLACE_ID=$(cat "$NOTIFY_ID_FILE")
else
    REPLACE_ID=0
fi

NEW_ID=$(notify-send --print-id --replace-id="$REPLACE_ID" "Brightness: $PERCENT%")
echo "$NEW_ID" > "$NOTIFY_ID_FILE"
